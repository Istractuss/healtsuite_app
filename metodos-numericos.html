<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Métodos Numéricos - Bisección</title>
    <link rel="stylesheet" href="css/metodos-numericos.css">
</head>
<body class="body-metodos-numericos">
    <header class="metodos-header">
        <h1>Métodos Numéricos</h1>
        <h2>Método de Bisección</h2>
    </header>
    <main>
        <div class="metodos-card">
            <form id="form-biseccion">
                <label>Método:
                    <select id="metodo-seleccionado">
                        <option value="biseccion">Bisección</option>
                        <option value="regla-falsa">Regla Falsa</option>
                        <option value="secante">Secante</option>
                        <option value="newton">Newton</option>
                    </select>
                </label><br><br>
                <label>Función f(x):
                    <input type="text" id="biseccion-funcion" placeholder="Ej: x^3 - x - 2" value="3x^3-3x+6" readonly required>
                    <button type="button" id="btn-editar-func" class="btn-biseccion" style="margin-left:8px;">Editar función</button>
                </label><br><br>
                <label>a (X0 / Xi):
                    <input type="text" id="biseccion-a" required placeholder="Ej: 1">
                    <span id="error-a" class="input-error" style="color:#b00;display:inline-block;margin-left:8px;"></span>
                </label><br><br>
                <label id="label-b">b (X1 / Xd):
                    <input type="text" id="biseccion-b" required placeholder="Ej: 5">
                    <span id="error-b" class="input-error" style="color:#b00;display:inline-block;margin-left:8px;"></span>
                </label><br><br>
                <label style="display:block;" id="label-deriv">Derivada (opcional para Newton):
                    <input type="text" id="biseccion-derivada" placeholder="Ej: 4*x+5">
                </label><br>
                <label>Error tolerado (ε):
                    <input type="number" id="biseccion-error" step="any" min="0" value="0.01" required>
                    <span id="error-tol" class="input-error" style="color:#b00;display:inline-block;margin-left:8px;"></span>
                </label><br><br>
                <label>Máximo de iteraciones:
                    <input type="number" id="biseccion-maxiter" min="1" max="500" value="100" required>
                </label><br><br>
                <button type="submit" class="btn-biseccion">Calcular</button>
            </form>
            <button id="btn-volver-menu" class="btn-biseccion" style="margin-top:20px;">Volver al menú principal</button>
        </div>
        <div id="biseccion-resultado" class="metodos-card" style="display:none;"></div>
        <div id="metodos-guia" class="metodos-card" style="display:none;">
            <h3>Guía paso a paso</h3>
            <p>Esta guía te muestra cómo obtener los resultados paso a paso para Bisección, Regla Falsa, Secante y Newton. Rellena los campos (puedes editar la función con "Editar función") y presiona "Calcular" para ver la tabla; la guía explica cómo se obtuvieron los números.</p>
            <ol>
                <li>Ingresa la función en notación humana, por ejemplo <code>2x^2+5x-2</code>. El parser convertirá <code>^</code> a potencias y añadirá multiplicaciones faltantes.</li>
                <li>Selecciona el método (Bisección, Regla Falsa, Secante o Newton).</li>
                <li>Introduce los valores iniciales: para Secante usa Xi=1 y Xd=5; para Newton usa X0=4; la tolerancia en el ejemplo es 0.01.</li>
                <li>Presiona "Calcular". La tabla mostrará cada iteración con 4 decimales (los cálculos internos usan máxima precisión).</li>
                <li>Para reproducir la fila de la hoja de cálculo del profesor: usa los Xi/Xd/X0 mostrados en la tabla y aplica la fórmula del método con los valores sin redondear, luego redondea el resultado final a 4 decimales para mostrar.</li>
            </ol>
            <h4>Ejemplo rápido (Secante, función 2x^2+5x-2)</h4>
            <p>Con Xi=1, Xd=5 y tol=0.01, la secante calcula X2 = X1 - f(X1)*(X1-X0)/(f(X1)-f(X0)). En la app usamos f en precisión completa para la fórmula y mostramos X2 redondeado a 4 decimales, reproduciendo la hoja del profesor.</p>
            <button id="btn-toggle-guia" class="btn-biseccion">Cerrar guía</button>
        </div>
    </main>
    <script src="js/metodos-numericos.js"></script>
    <script>
        // small UI helpers
        const metodoSel = document.getElementById('metodo-seleccionado');
        const labelB = document.getElementById('label-b');
        const labelDeriv = document.getElementById('label-deriv');
        if (metodoSel) {
            metodoSel.addEventListener('change', () => {
                labelB.style.display = metodoSel.value === 'newton' ? 'none' : '';
                labelDeriv.style.display = metodoSel.value === 'newton' ? '' : 'none';
            });
            // initial toggle
            metodoSel.dispatchEvent(new Event('change'));
        }
        // Note: example preset button removed per request.
        // Editar función button: toggle readonly so user can input custom function
        const btnEditarFunc = document.getElementById('btn-editar-func');
        const inputFunc = document.getElementById('biseccion-funcion');
        if (btnEditarFunc && inputFunc) {
            btnEditarFunc.addEventListener('click', () => {
                if (inputFunc.readOnly) {
                    // enable editing
                    inputFunc.readOnly = false;
                    inputFunc.focus();
                    btnEditarFunc.textContent = 'Aceptar función';
                } else {
                    // accept changes and disable editing
                    inputFunc.readOnly = true;
                    // normalize whitespace and restore default if empty
                    const DEFAULT_FUNC = '3x^3-3x+6';
                    const newVal = inputFunc.value.trim();
                    if (!newVal) {
                        inputFunc.value = DEFAULT_FUNC;
                    } else {
                        inputFunc.value = newVal;
                    }
                    btnEditarFunc.textContent = 'Editar función';
                    // trigger an input event so validators react to the new value
                    inputFunc.dispatchEvent(new Event('input'));
                }
            });
        }
    </script>
</body>
</html>
